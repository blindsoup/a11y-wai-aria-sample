<!doctype html>
<html lang="ja">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>aria-live</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
</head>

<body>
    <h1>A11y-wai-aria-sample</h1>
    <h2>aria-live</h2>
    <h3>polite status</h3>
    <div>
        <p>aria-live="polite" role="status"は、アイドル状態になってから更新内容を通知する。</p>
        <button type="button" class="action">更新</button>
        <button type="button" class="clear">クリア</button>
    </div>
    <div class="message" aria-live="polite" role="status"></div>

    <h3>assertive alert</h3>
    <div>
        <p>aria-live="assertive" role="alert"は、直ちに通知する。</p>
        <p>NVDA+Firefoxでは「アラート」という警告とともに割り込んで即座に読まれる。NVDA+Chromeの場合は、politeと挙動が変わらなかった。</p>
        <button type="button" class="action">更新</button>
        <button type="button" class="clear">クリア</button>
    </div>
    <div class="message" id="message2" aria-live="assertive" role="alert"></div>

    <h3>role="timer"</h3>
    <div>
        <p>経過時間・残り時間を含むライブ領域であることを支援技術に示す。暗黙的にaria-live属性はoff。</p>
        <p>このroleが直接的にスクリーンリーダーの読みに影響を与えることはなかった（NVDA+Chrome|Firefox）。</p>
        <button type="button" id="start-countdown">開始</button>
        <button type="button" id="stop-countdown">ストップ</button>
    </div>
    <div role="timer" aria-label="カウントダウンタイマー" id="timer"></div>

    <h3>role="progressbar"</h3>
    <div>    
        <p>進行状況バー。role="progressbar"を使うと、テキストノードはスクリーンリーダーユーザ側からは読めなくなる。代わりに、aria-valuenow属性が更新されると、その値を読み上げる。</p>
        <p>進行状況が更新されると、スクリーンリーダーがアイドル状態の時にその値が通知される（挙動としてはaria-live="polite"）。ただし、プログレスバーに重ねて、aria-live属性を示すのは誤りである。進行状況値を２重に読んでしまう。</p>
    </div>
    <div>
        <p>シンプルなプログレスバー。aria-valuenow、aria-valuemin、aria-valuemaxを使用。</p>
        <button type="button" id="progress1-button">取得</button>
        <div id="progress1-region" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
    <div>
        <p>メッセージ付きプログレスバー。aria-valuetext、aria-valuenow、aria-valuemin、aria-valuemaxを使用。</p>
        <button type="button" id="progress2-button">インストール</button>
        <div role="progressbar" aria-valuemin="0" aria-valuemax="100" id="progress2-region"></div>
    </div>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="./node_modules/jquery/dist/jquery.slim.min.js"></script>
    <script src="./node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    <script>
        $(function() {
            const message = `<p>メッセージ内容です。</p><p>メッセージが更新されるとスクリーンリーダーがそのテキストを通知します。</p>   `
            let timer = null
            let count = 10
            let progress1_timer = null
            let progress1_value = 0
            let progress2_timer = null
            let progress2_value = 0
            let progress2_step = 0
            let progress2_text = ['ステップ１：ダウンロードしています ... ','ステップ２：ファイルを展開しています ... ','ステップ３：準備しています ... ']

            $('.action').click(e => {
                setTimeout(() => $(e.currentTarget).parent().next().append(message), 2000)
            })
            $('.clear').click(e => $(e.currentTarget).parent().next().text(''))

            $('#start-countdown').click(() => {
                timer = setInterval(() => {
                    count--;
                    $('#timer').text(count)
                    if(count === 0){
                        clearInterval(timer)
                        count = 10
                    }
                }, 1000)
            })
            $('#stop-countdown').click(() => {
                clearInterval(timer)
                count = 10
            })

            $('#progress1-button').click(() => {
                progress1_timer = setInterval(() => {
                    $('#progress1-region').text(progress1_value).attr('aria-valuenow', progress1_value)
                    progress1_value += 10
                    if(progress1_value > 100){
                        clearInterval(progress1_timer)
                        progress1_value = 0
                    }
                }, 2000)
            })

            $('#progress2-button').click(() => {
                progress2_timer = setInterval(() => {
                    progress2_value += 20
                    if(progress2_value > 100){
                        progress2_value = 0
                        progress2_step++
                        if(progress2_step > 2){
                            clearInterval(progress2_timer)
                        }
                    }
                    $('#progress2-region').text(progress2_text[progress2_step] + progress2_value).attr({'aria-valuetext': progress2_text[progress2_step], 'aria-valuenow': progress2_value})
                }, 2000)
            })
        })
    </script>
</body>

</html>